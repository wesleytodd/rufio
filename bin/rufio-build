#! /usr/bin/env node

var app = require('commander');
var path = require('path');
var babel = require('babel-register');
var Site = require('../lib/site').Site;
var Type = require('../lib/type').Type;
var Item = require('../lib/item').Item;

app.option('-B, --no-babel', 'Enable babel transpilation');
app.option('-r, --site-root [path]', 'Sets the site root path', process.cwd());
app.parse(process.argv);

if (app.babel) {
	babel();
}

var site;
try {
	site = require(path.join(app.siteRoot, 'site.js'));
} catch(e) {
	console.log('couldnt find site.js');
	site = Site;
}

// Load rufio.json
var config;
try {
	config = require(path.join(app.siteRoot, 'rufio.json'));
} catch(e) {
	console.log('couldnt find rufio.json');
	config = {};
}

// Instantiate new site
site = new (site.default || site)(config);

site.load()
	.on('error', function (err) {
		throw err;
	})
	.on('data', function (item) {
		if (item instanceof Site) {
			return console.log('got site: ', item.get('title'));
		}
		if (item instanceof Type) {
			return console.log('got type: ', item.name);
		}
		if (item instanceof Item) {
			return console.log('got item: ', item.filename);
		}
	})
	.on('end', function () {
		console.log('loaded');
	});


/*
app.args.forEach(function (thing) {
	// Is it pointing at a file?
	console.log(thing);

});
*/
